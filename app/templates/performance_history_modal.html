<!-- Performance History Modal Content -->
<div class="performance-history-content">
    <h3>Performance History for {{ assignment.staff.nickname if assignment.staff else assignment.archived_staff_name }}</h3>
    <p><strong>Contract:</strong> {{ assignment.venue.name }} - {{ assignment.contract_role }} ({{ assignment.contract_type }})</p>
    <p><strong>Period:</strong> {{ assignment.start_date.strftime('%d %b %Y') }} to {{ assignment.end_date.strftime('%d %b %Y') }}</p>
    
    {% if assignment.performance_records %}
        <div class="performance-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Arrival</th>
                        <th>Drinks Sold</th>
                        <th>Special Comm.</th>
                        <th>Bonus</th>
                        <th>Malus</th>
                        <th>Lateness Penalty</th>
                        <th>Daily Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in assignment.performance_records|sort(attribute='record_date') %}
                    <tr>
                        <td>{{ record.record_date.strftime('%d %b %Y') }}</td>
                        <td>{{ record.arrival_time.strftime('%H:%M') if record.arrival_time else 'N/A' }}</td>
                        <td>{{ record.drinks_sold or 0 }}</td>
                        <td>{{ '{:,}'.format(record.special_commissions or 0) }} ฿</td>
                        <td>{{ '{:,}'.format(record.bonus or 0) }} ฿</td>
                        <td>{{ '{:,}'.format(record.malus or 0) }} ฿</td>
                        <td>{{ '{:,}'.format(record.lateness_penalty or 0) }} ฿</td>
                        <td>
                            {% set daily_salary = (assignment.base_salary / assignment.contract_type|int) + (record.bonus or 0) - (record.malus or 0) - (record.lateness_penalty or 0) %}
                            {% set daily_commission = (record.drinks_sold or 0) * 100 %}
                            {% set daily_total = daily_salary + daily_commission %}
                            {{ '{:,}'.format(daily_total) }} ฿
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="no-records">No performance records found for this assignment.</p>
    {% endif %}
    
    <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closePerformanceHistoryModal()">Close</button>
    </div>
</div>

<style>
.performance-history-content {
    padding: 20px;
}

.performance-history-content h3 {
    margin-bottom: 10px;
    color: #333;
}

.performance-history-content p {
    margin-bottom: 15px;
    color: #666;
}

.performance-table {
    margin: 20px 0;
    overflow-x: auto;
}

.performance-table table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.performance-table th,
.performance-table td {
    padding: 8px 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.performance-table th {
    background-color: #f5f5f5;
    font-weight: 600;
}

.performance-table tr:hover {
    background-color: #f9f9f9;
}

.no-records {
    text-align: center;
    color: #999;
    font-style: italic;
    padding: 40px;
}

.modal-actions {
    margin-top: 20px;
    text-align: right;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background-color: #5a6268;
}
</style>
