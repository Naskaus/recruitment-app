<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payroll Report</title>
    <style>
        @page { size: A4 landscape; margin: 1cm; }
        body { font-family: sans-serif; font-size: 8pt; color: #333; }
        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; }
        .filter-info { font-size: 7pt; color: #666; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 5px; text-align: left; }
        th { background-color: #f2f2f2; }
        .total-row td { font-weight: bold; background-color: #f8f8f8; }
        .profit-positive { color: #28a745; }
        .profit-negative { color: #dc3545; }
        .text-right { text-align: right; }
    </style>
</head>
<body>
    <div class="header">
        <h1>OS Agency - Payroll Report</h1>
        <p>Generated on: {{ report_date.strftime('%d %B %Y') }}</p>
    </div>

    {% if filters %}
        <div class="filter-info">
            <strong>Filters Applied:</strong>
            {% for key, value in filters.items() if value %}
                <span>{{ key.replace('_', ' ')|title }}: <strong>{{ value }}</strong>;</span>
            {% endfor %}
        </div>
    {% endif %}

    <table>
        <thead>
            <tr>
                <th>Staff</th>
                <th>Venue</th>
                <th>Manager</th>
                <th>Period</th>
                <th>Days Worked</th>
                <th class="text-right">Salary Paid</th>
                <th class="text-right">Commission Paid</th>
                <th class="text-right">Bar Profit</th>
            </tr>
        </thead>
        <tbody>
            {% for row in assignments %}
                <tr>
                    <td>{{ row.assignment.staff.nickname if row.assignment.staff else row.assignment.archived_staff_name }}</td>
                    <td>{{ row.assignment.venue.name }}</td>
                    <td>{{ row.assignment.manager.username if row.assignment.manager else 'N/A' }}</td>
                    <td>{{ row.assignment.start_date.strftime('%d/%m/%y') }} - {{ row.assignment.end_date.strftime('%d/%m/%y') }}</td>
                    <td>{{ row.days_worked }}</td>
                    <td class="text-right">{{ '%.0f'|format(row.contract_stats.salary) }} ฿</td>
                    <td class="text-right">{{ '%.0f'|format(row.contract_stats.commission) }} ฿</td>
                    <td class="text-right {% if row.contract_stats.profit > 0 %}profit-positive{% elif row.contract_stats.profit < 0 %}profit-negative{% endif %}">
                        {{ '%.0f'|format(row.contract_stats.profit) }} ฿
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" style="text-align: center;">No data for the selected filters.</td>
                </tr>
            {% endfor %}
        </tbody>
        {% if summary %}
        <tfoot>
            <tr class="total-row">
                <td colspan="4"><strong>Totals</strong></td>
                <td><strong>{{ summary.total_days_worked }}</strong></td>
                <td colspan="2"></td>
                <td class="text-right"><strong>{{ '%.0f'|format(summary.total_profit) }} ฿</strong></td>
            </tr>
        </tfoot>
        {% endif %}
    </table>
</body>
</html>