{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>{{ "Edit Profile" if edit_mode else "Create Staff Profile" }}</h2>
    </div>
    <div class="card-body">
        <div class="form-container">
            <form id="profileForm" 
                  enctype="multipart/form-data" 
                  data-mode="{{ 'edit' if edit_mode else 'create' }}"
                  data-id="{{ profile.id if profile else '' }}">
                
                <!-- Photo Upload -->
                <div class="form-group">
                    <label for="photo">Photo {{ "(Leave blank to keep current photo)" if edit_mode }}</label>
                    <div class="photo-preview-container">
                        <img id="photoPreview" 
                             src="{{ profile.photo_url if profile and profile.photo_url != '/static/images/default_avatar.png' else '' }}" 
                             alt="Photo preview" 
                             class="{{ '' if profile and profile.photo_url != '/static/images/default_avatar.png' else 'hidden' }}">
                        <div id="photoPlaceholder" class="photo-placeholder {{ 'hidden' if profile and profile.photo_url != '/static/images/default_avatar.png' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            <span>Upload Image</span>
                        </div>
                    </div>
                    <input type="file" id="photo" name="photo" accept="image/*">
                </div>
                
                <!-- Nickname (Required) -->
                <div class="form-group">
                    <label for="nickname">Nickname<span>*</span></label>
                    <input type="text" id="nickname" name="nickname" value="{{ profile.nickname if profile else '' }}" required>
                </div>

                <!-- Date of Birth (Required) -->
                <div class="form-group">
                    <label>Date of Birth<span>*</span></label>
                    <div class="form-group-inline">
                        <div class="form-sub-group">
                            <label for="dob_year" class="sub-label">Year</label>
                            <select id="dob_year" name="dob_year" required>
                                {% for year in years %}
                                    <option value="{{ year }}" {% if profile and profile.dob and year == profile.dob.year %}selected{% elif not profile and year == 2005 %}selected{% endif %}>{{ year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-sub-group">
                             <label for="dob_month" class="sub-label">Month</label>
                            <select id="dob_month" name="dob_month" required>
                                {% for month in months %}
                                    <option value="{{ month }}" {% if profile and profile.dob and month == profile.dob.month %}selected{% endif %}>{{ month }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-sub-group">
                            <label for="dob_day" class="sub-label">Day</label>
                            <select id="dob_day" name="dob_day" required>
                                {% for day in days %}
                                    <option value="{{ day }}" {% if profile and profile.dob and day == profile.dob.day %}selected{% endif %}>{{ day }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Admin/Mama -->
                <div class="form-group">
                    <label for="admin_mama_name">Managed by (Admin/Mama)</label>
                    <select id="admin_mama_name" name="admin_mama_name">
                        <option value="">Unassigned</option>
                        {% for admin in admins %}
                            <option value="{{ admin }}" {% if profile and profile.admin_mama_name == admin %}selected{% endif %}>{{ admin }}</option>
                    {% endfor %}
                    </select>
                </div>

                <!-- Optional Fields -->
                <div class="form-group">
                    <label for="first_name">First Name</label>
                    <input type="text" id="first_name" name="first_name" value="{{ profile.first_name if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="last_name">Last Name</label>
                    <input type="text" id="last_name" name="last_name" value="{{ profile.last_name if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="tel" id="phone" name="phone" value="{{ profile.phone if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="instagram">Instagram Username</label>
                    <input type="text" id="instagram" name="instagram" value="{{ profile.instagram if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="facebook">Facebook Profile ID or Username</label>
                    <input type="text" id="facebook" name="facebook" value="{{ profile.facebook if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="line_id">Line ID</label>
                    <input type="text" id="line_id" name="line_id" value="{{ profile.line_id if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" name="height" min="100" max="250" value="{{ profile.height if profile else '' }}">
                </div>
                <div class="form-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" name="weight" min="30" max="200" step="0.1" value="{{ profile.weight if profile else '' }}">
                </div>
                
                <button type="submit">{{ "Update Profile" if edit_mode else "Create Profile" }}</button>
            </form>
            <div id="form-response" class="hidden"></div>
        </div>
    </div>
</div>
{% endblock %}